# TCP
## 校验和
用于在一定程度上判断接受的数据是否有错误  

把数据分为每个16位，然后每个16位进行二进制求和，最后取反。期间的进位，回卷到
结果中，即 **+1**，不然如果进位丢失，导致接收到的求和数据和发送的求和数据
的后16位一致，校验和就失效了。

## 序列号 与 确认应答 (ACK)
解决丢包重传和乱序重排的问题

## 重传机制
### 超时重传
发送方设定一个定时器（RTO，Retransmission Timeout）。如果超时未收到 ACK，
则重发数据。  
难点：RTO 设定太难。太短会导致不必要的重传（网络拥塞），太长会导致响应慢。
TCP **动态计算** RTT（往返时间）来调整 RTO。
### 快速重传
如果发送方连续收到 3 个重复的 ACK，则认为该数据丢失，立即重传。

## 滑动窗口
设计思想：为了提高效率，不能采用“停止-等待”协议
（发一个等一个回）。TCP 允许发送方在未收到 ACK 的情况下连续发送多个数据包。  
机制：发送方维护一个发送窗口，接收方维护一个接收窗口。
窗口内的字节是可以被发送的。随着 ACK 的到来，窗口向右滑动。  
作用：实现了流水线机制，充分利用网络带宽。

## 流量控制
流量控制是为了控制发送方发送速率，保证接收方来得及接收。  
接收方发送的 ACK 中会包含自己的接收窗口大小，
发送方根据该值和当前网络拥塞程度来决定发送速率。

## 拥塞控制
拥塞控制是为了防止过多的数据注入到网络中，避免网络负载过重。  
慢启动，快重传，拥塞避免，快恢复。  
一开始发送方将拥塞窗口（congestion window，cwnd）
设置为一个最大报文段MSS的数值。 每收到一个 ACK，拥塞窗口加1。
当达到阈值后就进入拥塞避免阶段。
如果发生超时重传或者快速重传，则阈值设为当前拥塞窗口的一半。